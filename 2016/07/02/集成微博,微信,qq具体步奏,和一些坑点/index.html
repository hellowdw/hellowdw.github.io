<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>小武的技术栈</title>
  <meta name="author" content="王德武">
  
  <meta name="description" content="技术栈">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="小武的技术栈"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="小武的技术栈" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header"><div class="meta inner">
  <h1><a href="/">小武的技术栈</a></h1>
  <h2><a href="/">王德武</a></h2>
  <nav id="main-nav">
    <ul>
      
      <li><a href="/">首页</a></li>
      
      <li><a href="/archives">文章</a></li>
      
      <li><a href="/about">关于</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title"></h1>
  

      
        <time datetime="2016-07-01T18:26:56.000Z">2016-07-02</time>
      
    </header>
    <div class="entry">
      
        <hr>
<p>title: 集成微博,微信,qq具体步奏,和一些坑点<br>date: 2017-07-12<br>layout: ‘[layout]’<br>tags: 分享</p>
<h2 id="categories-iOS"><a href="#categories-iOS" class="headerlink" title="categories: iOS"></a>categories: iOS</h2><h1 id="为什么我用原生的分享"><a href="#为什么我用原生的分享" class="headerlink" title="为什么我用原生的分享?"></a>为什么我用原生的分享?</h1><h4 id="主要一个原因是如果不想把自己的appKey暴露给第三方"><a href="#主要一个原因是如果不想把自己的appKey暴露给第三方" class="headerlink" title="主要一个原因是如果不想把自己的appKey暴露给第三方"></a>主要一个原因是如果不想把自己的appKey暴露给第三方</h4><h3 id="第二一个就是如果用第三方的app的体积会比原生接入的大那么10MB左右吧-我当初在公司用过-记得用友盟的分享打包出来-比用原生接入的app体积大了10MB左右"><a href="#第二一个就是如果用第三方的app的体积会比原生接入的大那么10MB左右吧-我当初在公司用过-记得用友盟的分享打包出来-比用原生接入的app体积大了10MB左右" class="headerlink" title="第二一个就是如果用第三方的app的体积会比原生接入的大那么10MB左右吧(我当初在公司用过,记得用友盟的分享打包出来,比用原生接入的app体积大了10MB左右.)"></a>第二一个就是如果用第三方的app的体积会比原生接入的大那么10MB左右吧(我当初在公司用过,记得用友盟的分享打包出来,比用原生接入的app体积大了10MB左右.)</h3><p>下面是集成微博,微信,qq具体步奏,和一些坑点</p>
<a id="more"></a>
<h1 id="一-材料准备"><a href="#一-材料准备" class="headerlink" title="一.材料准备"></a>一.材料准备</h1><p>首先我们需要调料有 (点击链接下载~)<br><a href="https://github.com/sinaweibosdk/weibo_ios_sdk.git" target="_blank" rel="external">新浪微博sdk</a><br><a href="http://qzonestyle.gtimg.cn/qzone/vas/opensns/res/doc/iOS_SDK_V3.1.0.zip" target="_blank" rel="external">腾讯sdk</a><br><a href="https://res.wx.qq.com/open/zh_CN/htmledition/res/dev/download/sdk/WeChatSDK1.7.1.zip" target="_blank" rel="external">微信sdk</a></p>
<ul>
<li><p>新浪微微博我们需要的文件如图箭头所指<br><img src="http://upload-images.jianshu.io/upload_images/571446-01c89b71ac04fde8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_1.png"></p>
</li>
<li><p>微信我们需要的文件如下图箭头所指<br><img src="http://upload-images.jianshu.io/upload_images/571446-74be5b23c5a2ca8d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_2.png"></p>
</li>
<li><p>QQ分享我们需要的文件如下</p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-eb259154f6971437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_3.png"></p>
<h1 id="二-将我们需要的文件放到工程中去"><a href="#二-将我们需要的文件放到工程中去" class="headerlink" title="二.将我们需要的文件放到工程中去"></a>二.将我们需要的文件放到工程中去</h1><h4 id="1-进入工程文件文件夹"><a href="#1-进入工程文件文件夹" class="headerlink" title="1.进入工程文件文件夹"></a>1.进入工程文件文件夹</h4><p><img src="http://upload-images.jianshu.io/upload_images/571446-0d7a656921ef9334.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_5.png"></p>
<h4 id="2-新建Lib文件夹"><a href="#2-新建Lib文件夹" class="headerlink" title="2.新建Lib文件夹"></a>2.新建Lib文件夹</h4><blockquote>
<p>说明:<br>1.下载下来的微信Sdk中我们需要的”OpenSDK1.7.1”文件下面的所有文件我们将”OpenSDK1.7.1”文件直接复制到我们新建的Lib文件,但是为了区分我会将文件夹名称修改为”WeChatSDK_1.7.1” <br>2.QQ的分享我们只需要”TencentOpenAPI.framework”这个文件,但是我们还是要给他新建一个自己的文件夹”Tencent3.1.0” <br>3.新浪微博我们就直接将libWeiboSDK文件夹复制到Lib文件夹下面就ok了!</p>
</blockquote>
<p>如图</p>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-57d4760615a23a91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_6.png"></p>
<h3 id="3-将Lib文件夹添加到工程中去"><a href="#3-将Lib文件夹添加到工程中去" class="headerlink" title="3.将Lib文件夹添加到工程中去"></a>3.将Lib文件夹添加到工程中去</h3><p><img src="http://upload-images.jianshu.io/upload_images/571446-251dac85b1a4d7de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_7.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-e4b5e105200d2ee2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_8.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-48aab99fa56af2f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_9.png"></p>
<h1 id="三-添加SDK依赖的系统库文件"><a href="#三-添加SDK依赖的系统库文件" class="headerlink" title="三.添加SDK依赖的系统库文件"></a>三.添加SDK依赖的系统库文件</h1><p>“3333”表示新浪微博,qq,微信都依赖的</p>
<h4 id="1-微博依赖的系统库文件"><a href="#1-微博依赖的系统库文件" class="headerlink" title="1.微博依赖的系统库文件"></a>1.微博依赖的系统库文件</h4><blockquote>
<p>“1”QuartzCore.framework       // 独有<br>“2”ImageIO.framework          // 独有<br>“3”SystemConfiguration.framework  “3333”<br>“4”Security.framework           “共同——QQ和微博”<br>“5”CoreTelephony.framework      “共同——QQ和微博”<br>“6”CoreText.framework<br>“7”CoreGraphics.framework       “共同——QQ和微博”<br>“8”libz.dylib                  “33333”<br>“9”libsqlite3.dylib            “33333”</p>
</blockquote>
<h4 id="2-微信"><a href="#2-微信" class="headerlink" title="2.微信"></a>2.微信</h4><blockquote>
<p>SystemConfiguration.framework,”333”<br>libz.dylib,”3333”<br>libsqlite3.0.dylib,”3333”<br>libc++.dylib。// 独有</p>
</blockquote>
<h4 id="3-QQ"><a href="#3-QQ" class="headerlink" title="3.QQ"></a>3.QQ</h4><blockquote>
<p>“1””Security.framework”,  “共同—–QQ和微博”<br>“2”“libiconv.dylib”，// 独有<br>“3”“SystemConfiguration.framework”，”共同—–3”<br>“4”“CoreGraphics.Framework”、”共同——QQ和微博”<br>“5”“libsqlite3.dylib”、”共同——-3”<br>“6”“CoreTelephony.framework”、”共同—–QQ和微博”<br>“7”“libstdc++.dylib”、// 独有<br>“8”“libz.dylib””共同—–3”</p>
</blockquote>
<h4 id="4-总共我们需要添加的系统库文件"><a href="#4-总共我们需要添加的系统库文件" class="headerlink" title="4.总共我们需要添加的系统库文件"></a>4.总共我们需要添加的系统库文件</h4><blockquote>
<p>“1””Security.framework”<br>“2”“libiconv.dylib”<br>“3”“SystemConfiguration.framework”，<br>“4”“CoreGraphics.Framework”、<br>“5”“libsqlite3.dylib”<br>“6”“CoreTelephony.framework”<br>“7”“libstdc++.dylib”<br>“8”“libz.dylib”<br>“9”libc++.dylib<br>“10”QuartzCore.framework<br>“11”ImageIO.framework<br>“12”CoreText.framework</p>
</blockquote>
<h4 id="5-添加系统库文件例子"><a href="#5-添加系统库文件例子" class="headerlink" title="5.添加系统库文件例子"></a>5.添加系统库文件例子</h4><ul>
<li>以添加CoreText.framework为例,如下图</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-096276cf156733bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_10.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-2f1c4ba12107e05a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_11.png"></p>
<h4 id="6-新建framework文件夹"><a href="#6-新建framework文件夹" class="headerlink" title="6.新建framework文件夹"></a>6.新建framework文件夹</h4><ul>
<li>添加到项目中的系统库文件会自动放在工程文件的最顶上面如图</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-3f64c966a9dbab42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_12.png"></p>
<ul>
<li>新建framework文件将所有系统库文件放在里面</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-40cb20a15cb192bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_13.png"></p>
<h1 id="四-添加-ObjC-编译选项"><a href="#四-添加-ObjC-编译选项" class="headerlink" title="四.添加 -ObjC,编译选项"></a>四.添加 -ObjC,编译选项</h1><blockquote>
<p>在工程中引入静态库之后,需要在编译时添加 -ObjC,编译选项避免静态库中类加载不全造成程序崩溃. <br>方法:Target-&gt;Build Settings-&gt;Linking下 Other Linker Flags 项添加 -ObjC</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-6897cb139a5fac25.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_14.png"></p>
<h1 id="五-添加白名单"><a href="#五-添加白名单" class="headerlink" title="五.添加白名单"></a>五.添加白名单</h1><blockquote>
<p>iOS 9开始系统策略更新，限制了http协议的访问，此外应用需要在“Info.plist”中将要使用的URL Schemes列为白名单，才可正常检查其他应用是否安装。<br> 所以为了正常跳转到微信,微博,qq,我们需要在Info.plist,中添加如下代码</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;</div><div class="line">	&lt;array&gt;</div><div class="line">		&lt;string&gt;sinaweibohd&lt;/string&gt;</div><div class="line">		&lt;string&gt;sinaweibo&lt;/string&gt;</div><div class="line">		&lt;string&gt;sinaweibosso&lt;/string&gt;</div><div class="line">		&lt;string&gt;weibosdk&lt;/string&gt;</div><div class="line">		&lt;string&gt;weibosdk2.5&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqapi&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqq&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqOpensdkSSoLogin&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqconnect&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqopensdkdataline&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqopensdkgrouptribeshare&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqopensdkfriend&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqopensdkapi&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqopensdkapiV2&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqopensdkapiV3&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqzoneopensdk&lt;/string&gt;</div><div class="line">		&lt;string&gt;wtloginmqq&lt;/string&gt;</div><div class="line">		&lt;string&gt;wtloginmqq2&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqqwpa&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqzone&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqzonev2&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqzoneshare&lt;/string&gt;</div><div class="line">		&lt;string&gt;wtloginqzone&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqzonewx&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqzoneopensdkapiV2&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqzoneopensdkapi19&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqzoneopensdkapi&lt;/string&gt;</div><div class="line">		&lt;string&gt;mqzoneopensdk&lt;/string&gt;</div><div class="line">		&lt;string&gt;alipay&lt;/string&gt;</div><div class="line">		&lt;string&gt;alipayshare&lt;/string&gt;</div><div class="line">	&lt;/array&gt;</div></pre></td></tr></table></figure>
<p>流程图如下</p>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-2cd8600e55952195.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_18.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-0ba8d4b126041e5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_19.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-f1faaaaf35b23de5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_20.png"></p>
<ul>
<li>如果没有添加白名单,就可能出现,明明手机上已经安装了微博,分享时却说:”未安装微博客户端,是否现在去下载?” 如下图.</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-2a6631ef8925a8d8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="sddsds.jpg"></p>
<p><a href="http://www.jianshu.com/p/a8cce94d508e" target="_blank" rel="external">添加白名单,文案参考</a></p>
<h1 id="六-代码实现"><a href="#六-代码实现" class="headerlink" title="六.代码实现"></a>六.代码实现</h1><blockquote>
<p>我是用一个WTShareManager 统一管理微信,微博,QQ三者的分享 <br> 在WTShareManager 里面统一注册三者的app,并遵守三者的代理协议,然后三者分享时所需要的Image, title,url,summary, 用WTShareContentItem管理.外界根据WTShareManager 的WTShareType,然后传入WTShareContentItem进行各渠道的分享.</p>
</blockquote>
<ul>
<li>WTShareManager.h</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  WTShareManager.h</span></div><div class="line"><span class="comment">//  WTShare</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by Mac on 16/7/1.</span></div><div class="line"><span class="comment">//  Copyright © 2016年 wutong. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"WeiboSDK.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"WXApi.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;TencentOpenAPI/TencentOAuth.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;TencentOpenAPI/QQApiInterfaceObject.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;TencentOpenAPI/QQApiInterface.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@class</span> <span class="title">WTShareContentItem</span>;</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, WTShareType) &#123;</div><div class="line">    WTShareTypeWeiBo = <span class="number">0</span>,   <span class="comment">// 新浪微博</span></div><div class="line">    WTShareTypeQQ,          <span class="comment">// QQ好友</span></div><div class="line">    WTShareTypeQQZone,      <span class="comment">// QQ空间</span></div><div class="line">    WTShareTypeWeiXinTimeline,<span class="comment">// 朋友圈</span></div><div class="line">    WTShareTypeWeiXinSession,<span class="comment">// 微信朋友</span></div><div class="line">    WTShareTypeWeiXinFavorite,<span class="comment">// 微信收藏</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, WTShareWeiXinErrCode) &#123;</div><div class="line">    WTShareWeiXinErrCodeSuccess = <span class="number">0</span>,   <span class="comment">// 新浪微博</span></div><div class="line">    WTShareWeiXinErrCodeCancel = <span class="number">-2</span>,          <span class="comment">// QQ好友</span></div><div class="line">    </div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^WTShareResultlBlock)(<span class="built_in">NSString</span> * shareResult);</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WTShareManager</span> : <span class="title">NSObject</span> &lt;<span class="title">WBHttpRequestDelegate</span>,<span class="title">WeiboSDKDelegate</span>,<span class="title">WXApiDelegate</span>,<span class="title">TencentSessionDelegate</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">+ (<span class="keyword">instancetype</span>)shareWTShareManager;</div><div class="line"><span class="comment">// 判断QQ分享是否成功</span></div><div class="line">+ (<span class="keyword">void</span>)didReceiveTencentUrl:(<span class="built_in">NSURL</span> *)url;</div><div class="line">+ (<span class="keyword">void</span>)wt_shareWithContent:(WTShareContentItem *)contentObj shareType:(WTShareType)shareType shareResult:(WTShareResultlBlock)shareResult;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<ul>
<li>WTShareManager.m</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  WTShareManager.m</span></div><div class="line"><span class="comment">//  WTShare</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by Mac on 16/7/1.</span></div><div class="line"><span class="comment">//  Copyright © 2016年 wutong. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"WTShareManager.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"WTShareContentItem.h"</span></span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#define kAppKey         @<span class="meta-string">"2045436852"</span></span></div><div class="line"><span class="meta">#define kRedirectURI    @<span class="meta-string">"http://www.sina.com"</span></span></div><div class="line"><span class="meta">#define kWeixinAppId    @<span class="meta-string">"wxd930ea5d5a258f4f"</span></span></div><div class="line"><span class="meta">#define kTencentAppId   @<span class="meta-string">"222222"</span></span></div><div class="line"></div><div class="line"><span class="meta">#define kWTShareQQSuccess @<span class="meta-string">"0"</span></span></div><div class="line"><span class="meta">#define kWTShareQQFail      @<span class="meta-string">"-4"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WTShareManager</span> ()</span></div><div class="line">&#123;</div><div class="line">    TencentOAuth *_tencentOAuth;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)WTShareResultlBlock shareResultlBlock;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WTShareManager</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> WTShareManager * _instence;</div><div class="line"></div><div class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone</div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        _instence = [<span class="keyword">super</span> allocWithZone:zone];</div><div class="line">        [_instence setRegisterApps];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> _instence;</div><div class="line">&#125;</div><div class="line">+ (<span class="keyword">instancetype</span>)shareWTShareManager</div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        _instence = [[<span class="keyword">self</span> alloc]init];</div><div class="line">        [_instence setRegisterApps];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> _instence;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> _instence;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 注册appid</span></div><div class="line">- (<span class="keyword">void</span>)setRegisterApps</div><div class="line">&#123;</div><div class="line">    <span class="comment">// 注册Sina微博</span></div><div class="line">    [WeiboSDK registerApp:kAppKey];</div><div class="line">    <span class="comment">// 微信注册</span></div><div class="line">    [WXApi registerApp:kWeixinAppId];</div><div class="line">    </div><div class="line">    <span class="comment">// 注册QQ</span></div><div class="line">    _tencentOAuth = [[TencentOAuth alloc]initWithAppId:kTencentAppId andDelegate:<span class="keyword">self</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - 分享方法------</span></div><div class="line">+ (<span class="keyword">void</span>)wt_shareWithContent:(WTShareContentItem *)contentObj shareType:(WTShareType)shareType shareResult:(WTShareResultlBlock)shareResult</div><div class="line">&#123;</div><div class="line">    WTShareManager * shareManager = [WTShareManager shareWTShareManager];</div><div class="line">    shareManager.shareResultlBlock = shareResult;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> wt_shareWithContent:contentObj shareType:shareType];</div><div class="line">&#125;</div><div class="line">+ (<span class="keyword">void</span>)wt_shareWithContent:(WTShareContentItem *)contentObj shareType:(WTShareType)shareType</div><div class="line">&#123;</div><div class="line">    [WTShareManager shareWTShareManager];</div><div class="line">    </div><div class="line">    <span class="keyword">switch</span> (shareType) &#123;</div><div class="line">        <span class="keyword">case</span> WTShareTypeWeiBo:</div><div class="line">        &#123;</div><div class="line">            WBMessageObject *message = [WBMessageObject message];</div><div class="line">            message.text = contentObj.sinaSummary;</div><div class="line">            </div><div class="line">            <span class="keyword">if</span>(contentObj.bigImage)&#123;</div><div class="line">                WBImageObject *webpage = [WBImageObject object];</div><div class="line">                webpage.imageData =  <span class="built_in">UIImageJPEGRepresentation</span>(contentObj.bigImage, <span class="number">1.0</span>f);</div><div class="line">                </div><div class="line">                message.imageObject = webpage;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            WBSendMessageToWeiboRequest *request = [WBSendMessageToWeiboRequest requestWithMessage:message];</div><div class="line">            </div><div class="line">            [WeiboSDK sendRequest:request];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> WTShareTypeQQ:</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">NSString</span> * shareTitle = [<span class="built_in">NSString</span> string];</div><div class="line">            shareTitle = contentObj.qqTitle ? contentObj.qqTitle : contentObj.title;</div><div class="line">            </div><div class="line">            <span class="comment">//分享跳转URL</span></div><div class="line">            <span class="built_in">NSString</span> *urlt = contentObj.urlString;</div><div class="line">            QQApiNewsObject * newsObj ;</div><div class="line">            </div><div class="line">            <span class="keyword">if</span> (contentObj.urlImageString) &#123;</div><div class="line">                newsObj   = [QQApiNewsObject objectWithURL:[<span class="built_in">NSURL</span> URLWithString:urlt] title:shareTitle description:contentObj.summary previewImageURL:[<span class="built_in">NSURL</span> URLWithString:contentObj.urlImageString]];</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(contentObj.thumbImage)&#123;</div><div class="line">                <span class="comment">// 如果分享的是图片的话 不能太大所以如果后台过来的的图片太大的话 可以调节如下的倍数</span></div><div class="line">                <span class="built_in">NSData</span> *imageData = <span class="built_in">UIImageJPEGRepresentation</span>(contentObj.thumbImage, <span class="number">1.0</span>);</div><div class="line">                newsObj = [QQApiNewsObject objectWithURL:[<span class="built_in">NSURL</span> URLWithString:urlt] title:shareTitle description:contentObj.summary previewImageData:imageData];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            SendMessageToQQReq *req = [[SendMessageToQQReq alloc]init];</div><div class="line">            req.message = newsObj;</div><div class="line">            req.type = ESENDMESSAGETOQQREQTYPE;</div><div class="line">            <span class="comment">//将内容分享到qq</span></div><div class="line">            [QQApiInterface sendReq:req];</div><div class="line">            </div><div class="line">            </div><div class="line">            <span class="keyword">break</span>;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> WTShareTypeQQZone:</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//分享跳转URL</span></div><div class="line">            <span class="built_in">NSString</span> *urlt = contentObj.urlString;</div><div class="line">            </div><div class="line">            QQApiNewsObject * newsObj ;</div><div class="line">            <span class="keyword">if</span> (contentObj.urlImageString) &#123;</div><div class="line">                newsObj   = [QQApiNewsObject objectWithURL:[<span class="built_in">NSURL</span> URLWithString:urlt] title:contentObj.title description:contentObj.summary previewImageURL:[<span class="built_in">NSURL</span> URLWithString:contentObj.urlImageString]];</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(contentObj.thumbImage)&#123;</div><div class="line">                </div><div class="line">                <span class="built_in">NSData</span> * imageData = <span class="built_in">UIImagePNGRepresentation</span>(contentObj.thumbImage);</div><div class="line">                </div><div class="line">                newsObj = [QQApiNewsObject objectWithURL:[<span class="built_in">NSURL</span> URLWithString:urlt] title:contentObj.title description:contentObj.summary previewImageData:imageData];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            SendMessageToQQReq *req = [[SendMessageToQQReq alloc]init];</div><div class="line">            req.message = newsObj;</div><div class="line">            req.type = ESENDMESSAGETOQQREQTYPE;</div><div class="line">        </div><div class="line">            [QQApiInterface SendReqToQZone:req];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">            </div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> WTShareTypeWeiXinTimeline: <span class="comment">// 微信朋友圈</span></div><div class="line">        &#123;</div><div class="line">            WXMediaMessage * message = [WXMediaMessage message];</div><div class="line">            message.title = contentObj.weixinPyqtitle.length &gt;<span class="number">0</span> ? contentObj.weixinPyqtitle : contentObj.title;</div><div class="line">            [message setThumbImage:contentObj.thumbImage];</div><div class="line">            message.description = contentObj.summary;</div><div class="line">            WXWebpageObject * ext = [WXWebpageObject object];</div><div class="line">            ext.webpageUrl = contentObj.urlString;</div><div class="line">            message.mediaObject = ext;</div><div class="line">            SendMessageToWXReq * req = [[SendMessageToWXReq alloc]init];</div><div class="line">            req.bText = <span class="literal">NO</span>;</div><div class="line">            req.message = message;</div><div class="line">            req.scene = WXSceneTimeline;</div><div class="line">            [WXApi sendReq:req];</div><div class="line"></div><div class="line">            </div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> WTShareTypeWeiXinSession:</div><div class="line">        &#123;</div><div class="line">            WXMediaMessage * message = [WXMediaMessage message];</div><div class="line">            message.title = contentObj.title;</div><div class="line">            </div><div class="line">            [message setThumbImage:contentObj.thumbImage];</div><div class="line">            message.description = contentObj.summary;</div><div class="line">            WXWebpageObject * ext = [WXWebpageObject object];</div><div class="line">            ext.webpageUrl = contentObj.urlString;</div><div class="line">            message.mediaObject = ext;</div><div class="line">            </div><div class="line">            SendMessageToWXReq *req = [[SendMessageToWXReq alloc]init];</div><div class="line">            req.bText = <span class="literal">NO</span>;</div><div class="line">            req.message = message;</div><div class="line">            req.scene = WXSceneSession;</div><div class="line">            [WXApi sendReq:req];</div><div class="line">            </div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> WTShareTypeWeiXinFavorite:</div><div class="line">        &#123;</div><div class="line">            WXMediaMessage * message = [WXMediaMessage message];</div><div class="line">            message.title = contentObj.title;</div><div class="line">            </div><div class="line">            [message setThumbImage:contentObj.thumbImage];</div><div class="line">            message.description = contentObj.summary;</div><div class="line">            WXWebpageObject * ext = [WXWebpageObject object];</div><div class="line">            ext.webpageUrl = contentObj.urlString;</div><div class="line">            message.mediaObject = ext;</div><div class="line">            </div><div class="line">            SendMessageToWXReq *req = [[SendMessageToWXReq alloc]init];</div><div class="line">            req.bText = <span class="literal">NO</span>;</div><div class="line">            req.message = message;</div><div class="line">            req.scene = WXSceneFavorite;</div><div class="line">            [WXApi sendReq:req];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    </div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - WeiboSDKDelegate 从新浪微博那边分享过来传回一些数据调用的方法</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> 收到一个来自微博客户端程序的请求</div><div class="line"> </div><div class="line"> 收到微博的请求后，第三方应用应该按照请求类型进行处理，处理完后必须通过 [WeiboSDK sendResponse:] 将结果回传给微博</div><div class="line"> @param request 具体的请求对象</div><div class="line"> */</div><div class="line">- (<span class="keyword">void</span>)didReceiveWeiboRequest:(WBBaseRequest *)request&#123;&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> 收到一个来自微博客户端程序的响应</div><div class="line"> </div><div class="line"> 收到微博的响应后，第三方应用可以通过响应类型、响应的数据和 WBBaseResponse.userInfo 中的数据完成自己的功能</div><div class="line"> @param response 具体的响应对象</div><div class="line"> */</div><div class="line">- (<span class="keyword">void</span>)didReceiveWeiboResponse:(WBBaseResponse *)response</div><div class="line">&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     </div><div class="line">     WeiboSDKResponseStatusCodeSuccess               = 0,//成功</div><div class="line">     WeiboSDKResponseStatusCodeUserCancel            = -1,//用户取消发送</div><div class="line">     WeiboSDKResponseStatusCodeSentFail              = -2,//发送失败</div><div class="line">     WeiboSDKResponseStatusCodeAuthDeny              = -3,//授权失败</div><div class="line">     WeiboSDKResponseStatusCodeUserCancelInstall     = -4,//用户取消安装微博客户端</div><div class="line">     WeiboSDKResponseStatusCodePayFail               = -5,//支付失败</div><div class="line">     WeiboSDKResponseStatusCodeShareInSDKFailed      = -8,//分享失败 详情见response UserInfo</div><div class="line">     WeiboSDKResponseStatusCodeUnsupport             = -99,//不支持的请求</div><div class="line">     WeiboSDKResponseStatusCodeUnknown               = -100,</div><div class="line">     */</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (response.statusCode == WeiboSDKResponseStatusCodeSuccess) &#123;</div><div class="line">        <span class="comment">//NSLog(@"微博----分享成功!!!");</span></div><div class="line">        <span class="keyword">self</span>.shareResultlBlock(<span class="string">@"微博----分享成功!!!"</span>);</div><div class="line">        </div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(response.statusCode == WeiboSDKResponseStatusCodeUserCancel)</div><div class="line">    &#123;</div><div class="line"><span class="comment">//        NSLog(@"微博----用户取消发送");</span></div><div class="line">        <span class="keyword">self</span>.shareResultlBlock(<span class="string">@"微博----用户取消发送"</span>);</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (response.statusCode == WeiboSDKResponseStatusCodeSentFail)&#123;</div><div class="line"><span class="comment">//        NSLog(@"微博----发送失败!");</span></div><div class="line">        <span class="keyword">self</span>.shareResultlBlock(<span class="string">@"微博----发送失败!"</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">     </div><div class="line"><span class="comment">//    NSLog(@"%@", response);</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - WXApiDelegate 从微信那边分享过来传回一些数据调用的方法</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*! @brief 发送一个sendReq后，收到微信的回应</span></div><div class="line"> *</div><div class="line"> * 收到一个来自微信的处理结果。调用一次sendReq后会收到onResp。</div><div class="line"> * 可能收到的处理结果有SendMessageToWXResp、SendAuthResp等。</div><div class="line"> * @param resp具体的回应内容，是自动释放的</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>) onResp:(BaseResp*)resp</div><div class="line">&#123;</div><div class="line">    </div><div class="line">    <span class="comment">// 成功回来</span></div><div class="line">    <span class="comment">// errCode  0</span></div><div class="line">    <span class="comment">// type     0</span></div><div class="line">    </div><div class="line">    <span class="comment">// 取消分享回来</span></div><div class="line">    <span class="comment">// errCode -2</span></div><div class="line">    <span class="comment">// type 0</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (resp.errCode == WTShareWeiXinErrCodeSuccess) &#123;</div><div class="line"><span class="comment">//        NSLog(@"微信----分享成功!!");</span></div><div class="line">        <span class="keyword">self</span>.shareResultlBlock(<span class="string">@"微信----分享成功!!"</span>);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line"><span class="comment">//        NSLog(@"微信----用户取消分享!!");</span></div><div class="line">        <span class="keyword">self</span>.shareResultlBlock(<span class="string">@"微信----用户取消分享!!"</span>);</div><div class="line">    &#125;</div><div class="line"><span class="comment">//    NSLog(@"%@", resp);</span></div><div class="line">     </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - 判断qq是否分享成功</span></div><div class="line">+ (<span class="keyword">void</span>)didReceiveTencentUrl:(<span class="built_in">NSURL</span> *)url</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> * urlStr = url.absoluteString;</div><div class="line">    <span class="built_in">NSArray</span> * array = [urlStr componentsSeparatedByString:<span class="string">@"error="</span>];</div><div class="line">    <span class="keyword">if</span> (array.count &gt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="built_in">NSString</span> * lastStr = [array lastObject];</div><div class="line">        <span class="built_in">NSArray</span> * lastStrArray = [lastStr componentsSeparatedByString:<span class="string">@"&amp;"</span>];</div><div class="line">        </div><div class="line">        <span class="built_in">NSString</span> * resultStr = [lastStrArray firstObject];</div><div class="line">        <span class="keyword">if</span> ([resultStr isEqualToString:kWTShareQQSuccess]) &#123;</div><div class="line"><span class="comment">//            NSLog(@"QQ------分享成功!");</span></div><div class="line">            [WTShareManager shareWTShareManager].shareResultlBlock(<span class="string">@"QQ------分享成功!"</span>);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([resultStr isEqualToString:kWTShareQQFail])&#123;</div><div class="line"><span class="comment">//            NSLog(@"QQ------分享失败!");</span></div><div class="line">            [WTShareManager shareWTShareManager].shareResultlBlock(<span class="string">@"QQ------分享失败!"</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">     </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>WTShareContentItem.h<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  WTShareContentItem.h</span></div><div class="line"><span class="comment">//  WTShare</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by Mac on 16/7/1.</span></div><div class="line"><span class="comment">//  Copyright © 2016年 wutong. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WTShareContentItem</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIImage</span> *thumbImage;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIImage</span> *bigImage;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *imageType;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *title;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *weixinPyqtitle;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *qqTitle;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *urlString;<span class="comment">//</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *urlImageString;<span class="comment">// QQ,QQ空间分享加载图片用的</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSURL</span> *url;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *summary;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *type;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>)<span class="built_in">BOOL</span> isImageShareQQ; <span class="comment">// yes 代表用图片 NO代表用URL</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)<span class="built_in">NSString</span> * sinaSummary;</div><div class="line"></div><div class="line"></div><div class="line">+ (WTShareContentItem *)shareWTShareContentItem;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>WTShareContentItem.m<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  WTShareContentItem.m</span></div><div class="line"><span class="comment">//  WTShare</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by Mac on 16/7/1.</span></div><div class="line"><span class="comment">//  Copyright © 2016年 wutong. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"WTShareContentItem.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WTShareContentItem</span></span></div><div class="line"></div><div class="line"></div><div class="line">+ (WTShareContentItem *)shareWTShareContentItem</div><div class="line">&#123;</div><div class="line">    WTShareContentItem * item = [[WTShareContentItem alloc]init];</div><div class="line">    item.title = <span class="string">@"分享测试"</span>;</div><div class="line">    item.thumbImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"tu"</span>];</div><div class="line">    item.bigImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"tu"</span>];</div><div class="line">    item.summary = <span class="string">@"哈哈哈哈哈哈哈哈哈2!!!"</span>;</div><div class="line">    item.urlString = <span class="string">@"https://www.baidu.com"</span>;</div><div class="line">    item.sinaSummary = <span class="string">@"一般情况新浪微博的Summary和微信,QQ的是不同的,新浪微博的是一般带链接的,而且总共字数不能超过140字"</span>;</div><div class="line">    <span class="keyword">return</span> item;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>AppDelegate.m<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  AppDelegate.m</span></div><div class="line"><span class="comment">//  WTShare</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by Mac on 16/6/30.</span></div><div class="line"><span class="comment">//  Copyright © 2016年 wutong. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"WTShareManager.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></div><div class="line"></div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</div><div class="line">    <span class="comment">// Override point for customization after application launch.</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - 从别的应用回来</span></div><div class="line"></div><div class="line"><span class="comment">// iOS9 以上用这个方法接收</span></div><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)app openURL:(<span class="built_in">NSURL</span> *)url options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)options</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSDictionary</span> * dic = options;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, dic);</div><div class="line">    <span class="keyword">if</span> ([options[<span class="built_in">UIApplicationOpenURLOptionsSourceApplicationKey</span>] isEqualToString:<span class="string">@"com.sina.weibo"</span>]) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"新浪微博~"</span>);</div><div class="line">    </div><div class="line">        <span class="keyword">return</span> [WeiboSDK handleOpenURL:url delegate:[WTShareManager shareWTShareManager]];</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([options[<span class="built_in">UIApplicationOpenURLOptionsSourceApplicationKey</span>] isEqualToString:<span class="string">@"com.tencent.xin"</span>])&#123;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> [WXApi handleOpenURL:url delegate:[WTShareManager shareWTShareManager]];</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([options[<span class="built_in">UIApplicationOpenURLOptionsSourceApplicationKey</span>] isEqualToString:<span class="string">@"com.tencent.mqq"</span>])&#123;</div><div class="line">        </div><div class="line">        [WTShareManager didReceiveTencentUrl:url];</div><div class="line">        <span class="keyword">return</span> [TencentOAuth HandleOpenURL:url];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// iOS9 以下用这个方法接收</span></div><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application openURL:(<span class="built_in">NSURL</span> *)url sourceApplication:(<span class="built_in">NSString</span> *)sourceApplication annotation:(<span class="keyword">id</span>)annotation</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,url);</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ([sourceApplication isEqualToString:<span class="string">@"com.sina.weibo"</span>]) &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> [WeiboSDK handleOpenURL:url delegate:[WTShareManager shareWTShareManager]];</div><div class="line">        </div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([sourceApplication isEqualToString:<span class="string">@"com.tencent.xin"</span>])&#123;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> [WXApi handleOpenURL:url delegate:[WTShareManager shareWTShareManager]];</div><div class="line">        </div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([sourceApplication isEqualToString:<span class="string">@"com.tencent.mqq"</span>])&#123;</div><div class="line">     </div><div class="line">        [WTShareManager didReceiveTencentUrl:url];</div><div class="line">        <span class="keyword">return</span> [TencentOAuth HandleOpenURL:url];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)applicationWillResignActive:(<span class="built_in">UIApplication</span> *)application &#123;</div><div class="line">    <span class="comment">// Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.</span></div><div class="line">    <span class="comment">// Use this method to pause ongoing tasks, disable timers, and throttle down OpenGL ES frame rates. Games should use this method to pause the game.</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)applicationDidEnterBackground:(<span class="built_in">UIApplication</span> *)application &#123;</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)applicationWillEnterForeground:(<span class="built_in">UIApplication</span> *)application &#123;</div><div class="line">    <span class="comment">// Called as part of the transition from the background to the inactive state; here you can undo many of the changes made on entering the background.</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)applicationDidBecomeActive:(<span class="built_in">UIApplication</span> *)application &#123;</div><div class="line">    <span class="comment">// Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)applicationWillTerminate:(<span class="built_in">UIApplication</span> *)application &#123;</div><div class="line">    <span class="comment">// Called when the application is about to terminate. Save data if appropriate. See also applicationDidEnterBackground:.</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<h1 id="六-坑点"><a href="#六-坑点" class="headerlink" title="六.坑点"></a>六.坑点</h1><ul>
<li>QQ错误, 说找不到_TencentApiInterfaceDelegate代理<br>Undefined symbols for architecture armv7:<br>“l_OBJC<em>PROTOCOL</em>$_TencentApiInterfaceDelegate”, referenced from:<pre><code>l_OBJC_$_PROTOCOL_REFS_TencentSessionDelegate in WTShareManager.o
</code></pre>ld: symbol(s) not found for architecture armv7<br>clang: error: linker command failed with exit code 1 (use -v to see invocation)</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-5813a13fcd8dbea6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_16.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/571446-ca98366a00d84263.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_15.png"></p>
<ul>
<li>解决办法<blockquote>
<p>在TencentOpenAPI.framework 里面找到TencentOAuth.h文件,然后在里面包含#import “TencentApiInterface.h” 文件OK了.<br><img src="http://upload-images.jianshu.io/upload_images/571446-853b1ef1284fe4ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20160702_17.png"></p>
</blockquote>
</li>
</ul>

      
    </div>
      
      <footer>
        
        
        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>


<section id="comment">
  
</section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:www.ifeiair.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2017/06/08/react-redux/">react-redux</a>
      </li>
    
      <li>
        <a href="/2017/05/05/es5和es6创建类/">es5和es6创建类</a>
      </li>
    
      <li>
        <a href="/2017/05/02/require和import/">require和import</a>
      </li>
    
      <li>
        <a href="/2017/04/10/Bower的简介与安装/">bower的使用与安装</a>
      </li>
    
      <li>
        <a href="/2017/04/07/ReactNative最简单的ListView/">ReactNative最简单的ListView</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/iOS/">iOS</a><small>4</small></li>
  
    <li><a href="/categories/java/">java</a><small>5</small></li>
  
    <li><a href="/categories/react/">react</a><small>4</small></li>
  
    <li><a href="/categories/react-native/">react-native</a><small>2</small></li>
  
    <li><a href="/categories/微信小程序/">微信小程序</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/List-Set-泛型/" style="font-size: 10px;">List Set  泛型</a> <a href="/tags/bower/" style="font-size: 10px;">bower</a> <a href="/tags/button/" style="font-size: 10px;">button</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/es5和es6创建类/" style="font-size: 10px;">es5和es6创建类</a> <a href="/tags/final/" style="font-size: 10px;">final</a> <a href="/tags/implements/" style="font-size: 10px;">implements</a> <a href="/tags/ipa/" style="font-size: 10px;">ipa</a> <a href="/tags/kvo/" style="font-size: 10px;">kvo</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/react-listView/" style="font-size: 10px;">react_listView</a> <a href="/tags/redux/" style="font-size: 10px;">redux</a> <a href="/tags/reqire-module-exports/" style="font-size: 10px;">reqire module.exports</a> <a href="/tags/static/" style="font-size: 10px;">static</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/小程序/" style="font-size: 10px;">小程序</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 王德武
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



</body>
</html>

